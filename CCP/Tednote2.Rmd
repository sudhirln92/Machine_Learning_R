---
title: 'R combined cycle power plant Project '
output:
  pdf_document: default
  html_notebook: default
---

Problem statement:
The dataset contains 9568 data points collected from a Combined Cycle Power Plant over 6 years (2006-2011), when the power plant was set to work with full load. Features consist of hourly average ambient variables Temperature (T), Ambient Pressure (AP), Relative Humidity (RH) and Exhaust Vacuum (V) to predict the net hourly electrical energy output (EP) of the plant.
A combined cycle power plant (CCPP) is composed of gas turbines (GT), steam turbines (ST) and heat recovery steam generators. In a CCPP, the electricity is generated by gas and steam turbines, which are combined in one cycle, and is transferred from one turbine to another. While the Vacuum is colected from and has effect on the Steam Turbine, he other three of the ambient variables effect the GT performance.
For comparability with our baseline studies, and to allow 5x2 fold statistical tests be carried out, we provide the data shuffled five times. For each shuffling 2-fold CV is carried out and the resulting 10 measurements are used for statistical testing.

Loading all required library
```{r}
library(moments) #skewness
library(pastecs) #descriptive statistics stats.desc
library(diptest) # Hartigans' dip test for unimodality 
library(fmsb) #VIF
library(DAAG) #K-fold validation

```

Data import
Initial setwd command will set current working directory. The file in the format of csv(comma separated version) loaded to R in data.frame format.
str command will give observation,data type, name, few sample of variables.
colnames command will change column name.

Attribute Information:

Features consist of hourly average ambient variables 
- Temperature (T) in the range 1.81�C and 37.11�C,
- Ambient Pressure (AP) in the range 992.89-1033.30 milibar,
- Relative Humidity (RH) in the range 25.56% to 100.16%
- Exhaust Vacuum (V) in teh range 25.36-81.56 cm Hg
- Net hourly electrical energy output (EP) 420.26-495.76 MW
The averages are taken from various sensors located around the plant that record the ambient variables every second. The variables are given without normalization.

```{r}
setwd("/home/sudhir/git/ML-R")
data=read.csv("TED_OLS.csv",header=TRUE,na.string=c(" "))
str(data)
colnames(data)=c("Temperature","Exhaustvacuum","Pressure","Relativehumidity","Energy")
str(data) 

```

Finding missing value "NA" using "is.na()".
```{r}
#missing value
summary(is.na(data)) #column wise summary
table(is.na(data)) #Total summary
```

Measure of central tendency of data.
```{r}
summary(data)# M.o.CT
stat.desc(data)# M.o.CT +M.o.V
```

A boxplot provides a graphical view of the median, quartiles, maximum, and minimum of a data set. Outlier is an observation point that is distant from other observations.

A histogram is a graphical representation of the distribution of numerical data. It is an estimate of the probability distribution of a continuous variable.To contruct histogram,the first step is to "bin" the range of values—that is, divide the entire range of values into a series of intervals—and then count how many values fall into each interval.

plot(density(data$...) will give distribution of data



Univariate analysis of "Temperature" attribute
```{r}
boxplot(data$Temperature,main="Temperature Box Plot",col="red")
hist(data$Temperature,col="blue")
plot(density(data$Temperature),col="blue")
skewness(data$Temperature)
dip.test(data$Temperature)
```

Univariate analysis of "Exhaust vacuum" attribute
```{r}
hist(data$Exhaustvacuum,col="red")
boxplot(data$Exhaustvacuum,main="Exhaust Vacuum",col="red")
plot(density(data$Exhaustvacuum),col='brown')
skewness(data$Exhaustvacuum)
dip.test(data$Exhaustvacuum)
```

Univariate analysis of "Pressure" attribute
```{r}
boxplot(data$Pressure,main="Pressure",col="green")
hist(data$Pressure,col="yellow")
plot(density(data$Pressure),col='brown')
skewness(data$Pressure)
dip.test(data$Pressure)
```

Univariate analysis of "Energy" attribute
```{r}
boxplot(data$Energy,main="Energy",col="green")
hist(data$Energy,col="brown")
plot(density(data$Energy),col='brown')
skewness(data$Energy)
dip.test(data$Energy)
```

When data is not normally distributed, the cause for non-normality should be determined and appropriate remedial actions should be taken.Box cox transformation that may help to make data normal.
```{r}
c <- caret::BoxCoxTrans(data$Energy)
print(c)
data$newen=data$Energy^(-2)
```

Bivariate analysis
The covariance matrix generalizes the notion of variance to multiple dimensions.
A scatter plot provides a graphical view of the relationship between two sets of attributes.
```{r}
#Co-relation between IV and DV 
cor(data)
plot(data$Temperature,data$Energy,col=c("green","red"),main="Energy Vs. Temperature",font=10)
plot(data$Exhaustvacuum,data$Energy,col=c("yellow","red"),main="Energy Vs. Exhaustvacuum",font=10)
plot(data$Pressure,data$Energy,col=c("red","blue"),main="Energy Vs. Pressure",font=10)
plot(data$Relativehumidity,data$Energy,col=c("black","red"),main="Energy Vs. Relativehumidity",font=10)
pairs(data,col=c('red','blue'))
```

Sampling of data
```{r}
#cross validation
a=sample(nrow(data),nrow(data)*0.7)
train=data[a,]
test=data[-a,]
```

Data modeling
lm function will give linear regression
VIF is variance inflation factor
```{r}
#Model run/VIF check
model1=lm(Energy~.,data=train[,-6])
summary(model1)
VIF(model1)
model2=lm(Energy~Pressure+Relativehumidity+Exhaustvacuum,data=train)
summary(model2) 
VIF(model2)

model3=lm(newen~.,data=train[,-5])
summary(model1)
VIF(model1)
model=lm(newen~Pressure+Relativehumidity+Exhaustvacuum,data=train[,-5])
summary(model) 
VIF(model)
```

Model validation
R^2 will determine performation of model in predicted value.
```{r}
# Model validation in test
test=test[,-5]
pred=predict(model,test)
SSE <- sum((test$newen - pred) ^ 2)
SST <- sum((test$newen - mean(test$newen)) ^ 2)
rsquare=1 - SSE/SST
rsquare
test$pred=pred
rmse=(mean((test$Energy-test$pred)^2))^0.5
rmseTrain=(mean((train$Energy-model$fitted.values)^2))^0.5
```

Model assumption
```{r}
#Model Assumption Testing
plot(fitted.values(model),resid(model),col=c("red","yellow"))#homoscedasticity

#Breusch-Pagan test for homoscedasticity
library(lmtest)
lmtest::bptest(model)

plot(density(resid(model)))#normality
qqnorm(resid(model))
qqline(resid(model))
plot(train$Pressure,resid(model),col=c("red","blue"))#Linearity
plot(train$Relativehumidity,resid(model),col=c("red","yellow"))#Linearity
plot(train$Exhaustvacuum,resid(model),col=c("red","green"))#Linearity

# Model validation
res = cv.lm(data=data, (form.lm =Energy~Pressure+Relativehumidity+Exhaustvacuum),m=5,dots=FALSE,seed=29, plotit = c("Observed", "Residual"), legend.pos="topleft")

```

K fold summary
```{r}
#k fold summary
k=5
data$id <- sample(1:k, nrow(data), replace = TRUE)
list <- 1:k
for(i in 1:k){
  trainset <- subset(data,id %in% list[-i])
  testset <- subset(data,id %in% c(i))
  model <- lm(trainset$Energy~trainset$Pressure+trainset$Exhaustvacuum+trainset$Relativehumidity)
  predictions <- predict(model,testset[-c(4,5)])
  a <- summary(model)
   rmse <- sqrt(mean(model$residuals^2))
   print(model$coefficients)
   print(a$r.squared)
   print(rmse)
 }

# #Actual Vs. Fitted value
plot(fitted.values(model),data$Energy,col=c("red","blue"),main="Actual value vs. Fitted value")#Actual Vs. fitted

```

Project outcome: 
